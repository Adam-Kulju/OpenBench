{% extends "OpenBench/base.html" %}
{% block scripts %}

    var testMode = "stc";

    var configurations = {
        {% for name, data in config.engines.items %}
        '{{name}}' : {
            'stc'    : {
                "threads"     : "{{data.stc.threads}}",
                "hash"        : "{{data.stc.hash}}",
                "timecontrol" : "{{data.stc.timecontrol}}"
            },
            'ltc'    : {
                "threads"     : "{{data.ltc.threads}}",
                "hash"        : "{{data.ltc.hash}}",
                "timecontrol" : "{{data.ltc.timecontrol}}"
            },
            'smpstc' : {
                "threads"     : "{{data.smpstc.threads}}",
                "hash"        : "{{data.smpstc.hash}}",
                "timecontrol" : "{{data.smpstc.timecontrol}}"
            },
            'smpltc' : {
                "threads"     : "{{data.smpltc.threads}}",
                "hash"        : "{{data.smpltc.hash}}",
                "timecontrol" : "{{data.smpltc.timecontrol}}"
            },
        },
        {% endfor %}
    };

    function configure(mode) {

        // Update global test mode
        testMode = mode;

        // Find the selected engine
        var selection = document.getElementById("enginename");
        var engine = selection.options[selection.selectedIndex].value;

        // Parse out the needed configuration settings
        var threads     = configurations[engine][mode]["threads"];
        var hash        = configurations[engine][mode]["hash"];
        var timecontrol = configurations[engine][mode]["timecontrol"];

        // Adjust all the fields to auto-fill the settings
        document.getElementById("devoptions").value   = "Threads=" + threads + " Hash=" + hash;
        document.getElementById("baseoptions").value  = "Threads=" + threads + " Hash=" + hash;
        document.getElementById("timecontrol").value  = timecontrol;
    }
{% endblock %}
{% block content %}
<form method="POST" action="/newTest/">
    {% csrf_token %}
    <div id="left-settings">
        <h3> Engine </h3>
        <label> Engine Name </label>
        <select id="enginename" name="enginename" onchange="configure(testMode)">
        {% for name, data in config.engines.items %}
            {% if data.default %}
                <option selected value="{{name}}">{{data.name}}</option>
            {% else %}
                <option value="{{name}}">{{data.name}}</option>
            {% endif %}
        {% endfor %}
        </select><br>
        <label> Source </label>
        <input value="{{profile.repo}}" name="source"></br>
        <h3> DEV SETTINGS </h3>
        <label> Dev Branch </label>
        <input name="devbranch" autofocus></br>
        <label> Dev Bench </label>
        <input name="devbench"></br>
        <label> Dev Options </label>
        <input id="devoptions" name="devoptions"></br>
        <h3> BASE SETTINGS </h3>
        <label> Base Branch </label>
        <input value="master" name="basebranch"></br>
        <label> Base Bench </label>
        <input name="basebench"></br>
        <label> Base Options </label>
        <input id="baseoptions" name="baseoptions"></br>
    </div>
    <div id="right-settings">
        <h3> GAME SETTINGS </h3>
        <label> Opening Book </label>
        <select name="bookname">
        {% for name, data in config.books.items %}
            {% if data.default %}
                <option selected value="{{name}}">{{data.name}}</option>
            {% else %}
                <option value="{{name}}">{{data.name}}</option>
            {% endif %}
        {% endfor %}
        </select></br>
        <label> Time Control </label>
        <input id="timecontrol" name="timecontrol"></br>
        <h3> TEST SETTINGS </h3>
        <label> Priority </label>
        <input value="0" name="priority"></br>
        <label> Throughput </label>
        <input value="1000" name="throughput"></br>
        <h3> SPRT SETTINGS </h3>
        <label> Lower Bound </label>
        <input value="{{config.sprt.elolower}}" name="elolower"></br>
        <label> Upper Bound </label>
        <input value="{{config.sprt.eloupper}}" name="eloupper"></br>
        <label> Alpha </label>
        <input value="{{config.sprt.alpha}}" name="alpha"></br>
        <label> Beta </label>
        <input value="{{config.sprt.beta}}" name="beta"></br>
    </div>
    <br><input type="submit" name="submit" value="Create Engine Test"><br>
</form>
<div id="test-mode-buttons">
    <button class="left-floated"onClick="configure('stc')">Setup STC</button>
    <button class="right-floated"onClick="configure('ltc')">Setup LTC</button><br>
    <button class="left-floated"onClick="configure('smpstc')">Setup SMP STC</button>
    <button class="right-floated"onClick="configure('smpltc')">Setup SMP LTC</button>
</div>
{% endblock %}

